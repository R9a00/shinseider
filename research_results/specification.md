# アトツギ甲子園用システム - 詳細仕様書

## 1. はじめに

本ドキュメントは、アトツギ甲子園用システムの各機能（未来構想フェーズ、補助金レコメンド機能、事業計画フェーズ）の「基本の仕様」と、提供された調査レポートに基づく「変更のための仕様」を明確にし、今後の開発の指針とすることを目的とします。

## 2. 全体アーキテクチャ

*   **フロントエンド:** React (ポート: 3333)
*   **バックエンド:** FastAPI (Python, ポート: 8888)
*   **データ永続化:** ファイルベース (JSON, DOCX, TXT, YAML)

## 3. 機能ごとの詳細仕様

### 3.1. 未来構想フェーズ (Phase1)

#### 3.1.1. 基本の仕様

*   **目的:** ユーザーが自身の事業構想を整理し、言語化するためのQ&A形式の診断機能。
*   **UI:** 質問と自由記述のテキストエリア、前/次へボタン、診断完了ボタン。
*   **データ送信:** 診断完了時に、質問と回答のペアをJSON形式でバックエンドの `/save_desire` エンドポイントに送信。
*   **出力:** 診断結果をWordファイルとしてダウンロード。

#### 3.1.2. 変更のための仕様 (高度化)

*   **目的:** アトツギ甲子園の審査基準に沿った、より実践的な事業構想の整理と、説得力のあるWordレポートの生成。
*   **質問項目:**
    *   RTFファイル「アトツギ甲子園用システム高度化に関する包括的調査レポート.rtf」の「アトツギ甲子園における事業構想・計画の最適化要素」セクションで示された観点（事業アイデアの独創性、既存事業とのシナジー、社会課題解決への貢献、後継者自身のリーダーシップ、実現可能性、市場性、財務計画の妥当性、想い、パーソナルストーリーなど）を網羅する質問に更新。
    *   質問は、ユーザーの回答に応じて深掘りされる形式（ただし、現時点では自由記述のみ）。
*   **出力（診断レポート - Word形式）:**
    *   RTFファイル「アトツギ甲子園用システム高度化に関する包括的調査レポート.rtf」の「事業計画書作成における重要な視点と書き方」を参考に、アトツギ甲子園の審査員が読みやすく、評価しやすい構造で出力。
    *   以下のセクションを設ける:
        *   はじめに
        *   未来構想の概要
        *   背景と動機
        *   提供価値と対象
        *   リソース活用戦略
        *   課題と克服戦略
        *   アトツギ甲子園への目標
        *   後継者の想い・ストーリー
    *   各セクションには、ユーザーの回答を整形して反映させる。
    *   特に「後継者の想い・ストーリー」は、ユーザーのパーソナルな側面を強調する形で記述する。
*   **データ保存:**
    *   ユーザーの回答は、バックエンドで構造化されたJSON形式で `desire.txt` に保存する（将来的にはデータベース化を検討）。

### 3.2. 補助金レコメンド機能

#### 3.2.1. 基本の仕様

*   **目的:** ユーザーの事業内容や状況に基づき、最適な補助金をレコメンドする。
*   **UI:** ユーザーからの情報収集のためのフォーム（事業の目的、事業内容、ターゲット市場、自社の強み、希望補助金額、従業員数、財務状況、賃上げ意向、地域貢献意向）。
*   **データ送信:** フォーム入力後、バックエンドの `/subsidy_recommendation` エンドポイントにJSON形式で送信。
*   **出力:** レコメンドされた補助金リストと概要を表示。

#### 3.2.2. 変更のための仕様 (高度化)

*   **目的:** 補助金申請の採択率向上に貢献する具体的な指南を提供し、LLM連携の基盤を構築する。
*   **補助金データ管理:**
    *   `backend/subsidies.yaml` を作成し、RTFファイル「アトツギ甲子園用システム高度化に関する包括的調査レポート02.rtf」で提案されたYAML形式のデータモデルを基に、各補助金の詳細情報を定義する。
    *   定義する情報:
        *   `id`, `name`, `description`, `max_amount`, `eligible_expenses`, `application_period`, `official_url`
        *   `requirements`: 必須要件（`key`, `description`, `check_logic`, `feedback_on_fail`）
        *   `scoring_factors`: 加点ポイント（`key`, `type`, `weight`, `description`, `related_user_data`, `guidance_prompt`）
        *   `common_mistakes`: よくある不備とその回避策
*   **質問生成 (動的):**
    *   ユーザーの入力（事業の目的など）に応じて、`subsidies.yaml`から関連する補助金の`requirements`や`scoring_factors`を抽出し、動的に質問を生成し、フロントエンドに提示する。
    *   質問は、選択肢形式（ラジオボタン、チェックボックス）と自由記述形式を組み合わせる。
*   **レコメンドロジック:**
    *   ユーザーの回答と`subsidies.yaml`の`requirements`を照合し、合致する補助金を絞り込む。
    *   `scoring_factors`の`weight`を考慮し、ユーザーの回答が加点ポイントにどれだけ合致しているかをスコアリングする。
    *   スコアに基づいて、レコメンド順位を決定する。
*   **指南生成:**
    *   レコメンドされた補助金ごとに、`advice_points`、`common_mistakes`、そして`scoring_factors`の`guidance_prompt`を基に、LLMが活用できる形式で具体的な申請指南を生成する。
    *   ユーザーの回答が要件を満たさない場合、`feedback_on_fail`メッセージを提示する。
*   **LLM連携:**
    *   LLMへのプロンプト生成テンプレート（RTFファイル「アトツギ甲子園用システム高度化に関する包括的調査レポート02.rtf」の`llm_prompt_template`）を実装し、ユーザーの回答と補助金データをLLMに送信する。
    *   LLMからの応答を解析し、ユーザーに分かりやすい形で表示する。

### 3.3. 事業計画フェーズ (BusinessPlan)

#### 3.3.1. 基本の仕様

*   **目的:** ユーザーが事業計画書を効率的に作成できるよう支援する。
*   **UI:** リッチテキストエディタによる自由記述入力。
*   **データ送信:** 入力内容をJSON形式でバックエンドの `/generate_business_plan` エンドポイントに送信。
*   **出力:** 入力内容をWordファイルとしてダウンロード。

#### 3.3.2. 変更のための仕様 (高度化)

*   **目的:** アトツギ甲子園の事業計画書として、より完成度の高いドキュメントを生成する。
*   **入力項目:**
    *   アトツギ甲子園の事業計画書に求められる主要な項目（事業概要、市場分析、競合分析、製品・サービス、マーケティング戦略、収益計画、資金計画、実施体制など）を網羅する入力フォームを提供する。
    *   「未来構想フェーズ」で入力された情報を自動的に引き継ぎ、ユーザーの再入力を最小限にする。
*   **出力（事業計画書 - Word形式）:**
    *   入力された情報を基に、`python-docx`ライブラリを使用して、整形されたWord形式の事業計画書を生成する。
    *   RTFファイル「アトツギ甲子園用システム高度化に関する包括的調査レポート.rtf」の「事業計画書作成における重要な視点と書き方」を参考に、各セクションの構成と内容を最適化する。
*   **LLM連携:**
    *   ユーザーの入力内容を基に、LLMが事業計画書の各セクションに対する具体的なアドバイスや改善提案を生成できるようにする。

## 4. 全体タスクリストとシステム連携

### 4.1. 基本の仕様

*   **目的:** ユーザーがアトツギ甲子園参加から事業化、補助金申請までの全体プロセスを把握し、システムがその進捗を管理・支援する。
*   **UI:** 各機能へのリンクを持つシンプルなトップページ。

### 4.2. 変更のための仕様 (高度化)

*   **目的:** ユーザーが迷うことなく次のステップに進めるよう、進捗管理とナビゲーションを強化する。
*   **タスクフロー表示:**
    *   アトツギ甲子園の応募から事業化まで、補助金申請の全フェーズを統合したタスクフローを視覚的に表示する。
    *   各タスクのステータス（未着手、進行中、完了）を表示する。
*   **タスク詳細:**
    *   各タスクをクリックすると、そのタスクの目的、必要な情報、システムで利用できる機能、次のステップなどを表示する。
*   **進捗管理:**
    *   ユーザーのシステム利用状況（例: 未来構想フェーズの完了、補助金レコメンドの実行）に応じて、自動的にタスクの進捗を更新する。
    *   ユーザーが手動でタスクの完了をマークできる機能。
*   **リマインダー/通知:**
    *   重要な期限（例: 補助金申請期限、アトツギ甲子園応募期限）が近づいた際に、ユーザーに通知する。
*   **データ連携:**
    *   各機能間でユーザーが入力した情報をシームレスに連携させる。
    *   例えば、未来構想フェーズで入力した事業概要が、事業計画フェーズの初期入力として自動的に反映されるなど。

## 5. Git管理とTDDの徹底

*   **Git管理:** すべての変更はGitで管理し、適切な粒度でコミットを行う。コミットメッセージは、変更内容が明確にわかるように記述する。必要に応じてブランチを適切に利用する。
*   **TDD (テスト駆動開発):** 各機能の変更や新規実装を行う前に、まずテストコードを記述する。テストが失敗することを確認した後、機能コードを実装し、テストが成功することを確認する。リファクタリングを行う際も、テストが常にパスすることを確認しながら進める。
