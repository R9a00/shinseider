# データ整合性ルール

## 基本原則

### 1. 作成日と参照日の論理的整合性
- **補助金の作成日** ≤ **参照元の参照日（accessed_date）**
- 作成時には、その時点で最新の情報を参照する
- 過去の日付の情報を新規作成時に参照することは論理的に不可能

### 2. 参照日の自動設定ルール
- **新規作成時**: 作成日と同じ日付を参照日に設定
- **既存データ更新時**: 更新実行日を参照日に設定
- **一括更新時**: 一括更新実行日を全ての参照日に統一

### 3. バージョン履歴の整合性
- 参照日が更新された場合は必ず `reference_updated: true` をマーク
- 更新履歴に明確な更新理由を記録

## 修正が必要だった問題例

### 中小企業省力化投資補助金（shoukuritsuka_ippan）
- **作成日**: 2025-08-12
- **問題**: 参照日が 2025-01-11 になっていた
- **修正**: 参照日を 2025-08-14 に更新
- **論理**: 8/12に作成されたものが1/11の情報を参照するのは不可能

## 自動チェック項目

### 完全性チェッカーで監視すべき項目
1. 作成日 > 参照日 の場合は異常として検出
2. 参照日が90日以上古い場合は要更新として検出
3. 同一補助金内で参照日がバラバラの場合は要統一として検出

## 今後の運用

### 新規補助金追加時
1. 作成日 = 参照日 = 実際の作成実行日
2. 初回作成の変更履歴エントリに `reference_updated: true`

### 定期更新時
1. 全補助金の参照日を更新実行日に統一
2. 情報ソース品質スコアの向上を確認
3. 論理的整合性の自動チェック実行

## 実装

この整合性ルールは `minimal_integrity_checker.py` の `_check_temporal_accuracy` 関数で自動監視されています。