# 📋 定期保守実行指示書

## 🎯 実行コマンド: 「定期保守を実行してください」

この指示を受けた際は、**必ず以下のいずれかの方法で実行**してください。

---

## 🚀 方法1: 自動実行スクリプト（推奨）

### コマンド1行で完了
```bash
cd /Users/r9a/exp/attg/backend && python3 run_maintenance.py
```

### 実行内容
- ✅ システム稼働状況確認（フロントエンド・バックエンド・バックアップ）
- ✅ LLM更新プロンプト自動生成
- ✅ API動作検証（各補助金エンドポイント）
- ✅ 更新履歴・ログ確認
- ✅ 次回保守予定日記録
- ✅ 実行レポート自動生成

### 期待される出力
```
🚀 補助金システム定期保守を開始します...
実行日時: 2025-08-14 10:30:15

🔄 Phase1_システム状態確認 開始...
✅ フロントエンドサーバー稼働確認: 正常
✅ バックエンドAPI稼働確認: 正常
✅ 最新バックアップ確認: subsidies.yaml.backup.20250814_103015

🔍 Phase2_情報更新実行 開始...
✅ LLM更新プロンプト生成: 完了
⚠️ LLM調査実行: 手動実行が必要 - llm_update_prompt.mdをLLMに投入してください

🎯 Phase3_動作検証 開始...
✅ shinjigyo_shinshutsu API: 正常応答 (application_period含む)
✅ atotsugi API: 正常応答 (application_period含む)
✅ monodukuri_r7_21th API: 正常応答 (application_period含む)

📊 Phase4_ログ履歴確認 開始...
✅ version_history.yaml確認: 最終更新 2025-08-14
✅ 管理中補助金数: 6件

🔧 Phase5_次回準備 開始...
✅ 次回更新予定日記録: 2025-08-28

📄 レポート保存: maintenance_report_20250814_103045.json

🎉 定期保守完了: 全システム正常稼働中
```

---

## 📋 方法2: 手動チェックリスト実行

手動で詳細確認したい場合は、以下ファイルに従って実行：

```bash
cat /Users/r9a/exp/attg/backend/maintenance_checklist.md
```

**チェックリストの全項目を順番通りに実行し、完了報告を記録してください。**

---

## 🔄 LLM調査が必要な場合の追加手順

自動スクリプト実行後、以下の警告が出た場合の対応：

```
⚠️ LLM調査実行: 手動実行が必要 - llm_update_prompt.mdをLLMに投入してください
```

### 追加実行手順
```bash
# 1. 更新されたプロンプトを表示
cat /Users/r9a/exp/attg/backend/llm_update_prompt.md

# 2. 上記内容をLLM（Claude等）に貼り付けて調査実行

# 3. 調査結果をYAMLファイルで保存（例: research_2025-08-14.yaml）

# 4. 調査結果を自動反映
python3 /Users/r9a/exp/attg/backend/update_subsidies_from_research.py
# → プロンプトで調査結果YAMLファイルのパスを入力

# 5. 再度システム検証
python3 /Users/r9a/exp/attg/backend/run_maintenance.py --auto
```

---

## 📊 実行結果の確認方法

### 成功パターン
- 終了メッセージ: `🎉 定期保守完了: 全システム正常稼働中`
- 終了コード: 0

### 警告パターン  
- 終了メッセージ: `⚠️ 定期保守完了: 一部警告あり、動作に影響なし`
- 終了コード: 1
- **→ 動作に影響なし、継続監視**

### エラーパターン
- 終了メッセージ: `🚨 定期保守完了: エラーあり、要対応` 
- 終了コード: 2
- **→ 即座に管理者連絡・緊急対応必要**

---

## 📝 実行頻度

### 定期実行
- **推奨頻度**: 2週間に1回（14日間隔）
- **実行タイミング**: 営業時間外（平日夜間または週末）
- **次回予定**: スクリプトが自動で`maintenance_log.txt`に記録

### 緊急実行
以下の場合は即座に実行：
- 補助金制度の重要な変更発表
- システムエラー・不具合報告
- ユーザーから情報の古さに関する指摘

---

## 🚨 エラー時の緊急対応

### バックアップからの復旧
```bash
cd /Users/r9a/exp/attg/backend
# 最新のバックアップファイルを確認
ls -la *.backup.* | head -5

# 必要に応じて復旧
cp subsidies.yaml.backup.YYYYMMDD_HHMMSS subsidies.yaml
cp version_history.yaml.backup.YYYYMMDD_HHMMSS version_history.yaml
```

### 管理者連絡
- **担当者**: 羽生田大陸（株式会社羽生田鉄工所）
- **連絡タイミング**: エラー終了コード2の場合は即座に連絡
- **報告内容**: 実行時刻、エラー詳細、maintenance_report_*.jsonファイル

---

## ✅ 実行完了の確認項目

以下が全て確認できれば保守実行完了：

- [ ] スクリプトが正常終了（終了コード0または1）
- [ ] 実行レポートファイルが生成されている
- [ ] フロントエンド画面で補助金情報が正常表示
- [ ] 期限切れ補助金で適切な警告表示
- [ ] 次回保守予定日が記録されている

**このドキュメントに従うことで、確実で漏れのない定期保守が実行できます。**